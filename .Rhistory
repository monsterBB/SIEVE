library(MASS)
library('fda')
library(basefun)
library("KernSmooth")
data("cps71")
X = cps71$age
Y = cps71$logwage
#linear regression
model.lr <- lm(logwage ~ age, data = cps71)
summary(model.lr)
#Parametric model
model.par <- lm(logwage ~ age + I(age^2), data = cps71)
summary(model.par)
#Kernel estimation
model.np <- npreg(logwage ~ age,
regtype = "ll",
bwmethod = "cv.aic",
gradients = TRUE,
data = cps71)
summary(model.np)
#local polynomial estimation
model.lp <- locpoly(X, Y, degree = 5, kernel = "normal", bandwidth = 20)
#B-spline estimation
basis_fun = function(degr){
ra         = range(X)#boundary knots
numk       = 3 #number of inner knots
mid        = seq(ra[1], ra[2], length.out = numk +2)[2: (numk+1)]#inner knots(quantiles)
deg        = degr #degree
numb       = 3+ deg + 1
basis = bs(X, df = NULL, knots = mid, degree = deg, intercept = T,  Boundary.knots = range(X))
return(basis)
}
basis1 = basis_fun(3)
basis2 = basis_fun(10)
basis3 = basis_fun(25)
model.Bspline1 = lm ( logwage ~ basis1, data = cps71)
model.Bspline2 = lm ( logwage ~ basis2, data = cps71)
model.Bspline3 = lm ( logwage ~ basis3, data = cps71)
#plot basis of degree=3
plot(X,basis1[,1],"l")
lines(X,basis1[,2])
lines(X,basis1[,3])
lines(X,basis1[,4])
lines(X,basis1[,5])
lines(X,basis1[,6])
lines(X,basis1[,7])
#polynomial basis
pol_fun = function(degree_pol){
array_pol = array(0, dim = c(degree_pol, length(X)))
for (i in 0:degree_pol){
if (i+1<= degree_pol){
array_pol [i+1,] = X^i
}
}
basis_pol = t(as.matrix(array_pol))
return(basis_pol)
}
basis_pol1 =  pol_fun(4)
basis_pol2 =  pol_fun(6)
basis_pol3 =  pol_fun(8)
model.pol1 = lm ( logwage ~ basis_pol1, data = cps71)
model.pol2 = lm ( logwage ~ basis_pol2, data = cps71)
model.pol3 = lm ( logwage ~ basis_pol3, data = cps71)
mid
basis_fun = function(degr){
ra         = range(X)#boundary knots
numk       = 3 #number of inner knots
mid        = seq(ra[1], ra[2], length.out = numk +2)[2: (numk+1)]#inner knots(quantiles)
deg        = degr #degree
numb       = 3+ deg + 1
ra
ra         = range(X)
#linear spline basis
x         = range(X)#boundary knots
x
numk
numk       = 3
mid        = seq(ra[1], ra[2], length.out = numk +2)[2: (numk+1)]
mid
length(X)/3
length(X)
(length(X)+3)/3)
(length(X)+3)/3
length(X)
length(X)/5
x         = range(X)#boundary knots
numk       = 5 #number of inner knots
mid        = seq(ra[1], ra[2], length.out = numk +2)[2: (numk+1)]#inner knots(quantiles)
length(knots)
order(X)
mid
order(X)/5
max(X)/5
sort(X)
#linear spline basis
x         = range(order(X))#boundary knots
x
mid        = seq(x[1], x[2], length.out = numk +2)[2: (numk+1)]#inner knots(quantiles)
mid
seq(x[1], x[2], length.out = numk +2)
35-1
69-35
seq(x[1], x[2], length.out = numk +1)
if (X[i] >= knots[j]){
array_pol [i+1,] = X[i]-knots[j]
}
seq(x[1], x[2], length.out = numk +2)
205/35
205/34
205/5
knots        = seq(x[1], x[2], length.out = numk)
knots
103-52
154-103#polynomial basis
205-154pol_fun = function(degree_pol){
array_pol = array(0, dim = c(degree_pol, length(X)))
for (i in 0:degree_pol){
if (i+1<= degree_pol){
array_pol [i+1,] = X^i
}
}
basis_pol = t(as.matrix(array_pol))
return(basis_pol)
}
205-154
length(knots)
length(knots)
length(knots)
knots        = seq(x[1], x[2], length.out = numk)
array_lin = array(0, dim = c(length(knots), length(X)/numk))
knots
numk       = 7 #number of inner knots
knots        = seq(x[1], x[2], length.out = numk)
knots
array_lin = array(0, dim = c((length(knots)-1), length(X)/numk))
array_lin
lin_fun = function(numk){
knots        = seq(x[1], x[2], length.out = numk)
array_lin = array(0, dim = c((length(knots)-1), length(X)/numk))
for (i in 1:length(knots)){
array_pol [i,] = sort(X)[knots[i]:(knots[i+1]-1)]-knots[i]
}
}
lin_fun = function(numk){
knots        = seq(x[1], x[2], length.out = numk)
array_lin = array(0, dim = c((length(knots)-1), length(X)/numk))
for (i in 1:length(knots)){
array_lin [i,] = sort(X)[knots[i]:(knots[i+1]-1)]-knots[i]
}
basis_lin = t(as.matrix(array_lin))
return(basis_lin)
}
lin_fun(7)
sort(X)[knots[1]:(knots[2]-1)]
sort(X)[knots[1]:(knots[2]-1)]-knots[1]
sort(X)[knots[2]:(knots[3]-1)]-knots[2]
sort(X)[knots[2]:(knots[3]-1)]-sort(X)[knots[2]]
array_lin = array(0, dim = c((length(knots)-1), length(X)/numk))
for (i in 1:length(knots)){
array_lin [i,] = sort(X)[knots[i]:(knots[i+1]-1)]-sort(X)[knots[i]]
}
sort(X)[knots[i]]
sort(X)[knots[i]:(knots[i+1]-1)]
S = sort(X)
for (i in 1:length(knots)){
array_lin [i,knots[i]:(knots[i+1]-1)] = S[knots[i]:(knots[i+1]-1)]-S[knots[i]]
}
length(knots)
array_lin = array(0, dim = c((length(knots)-1), length(X)))
length(X)
knots[1]:(knots[1+1]-1)
knots[2]:(knots[2+1]-1)
knots[3]:(knots[3+1]-1)
knots[4]:(knots[4+1]-1)
knots[5]:(knots[5+1]-1)
knots[6]:(knots[6+1]-1)
knots[7]:(knots[7+1]-1)
205/7
205/5
x            = range(order(X))
knots        = seq(x[1], x[2]+1, length.out = numk)
knots
round(knots)
knots        = seq(x[1], x[2], length.out = numk)
nots
knots
knots
numk       = 5 #number of inner knots
knots        = seq(x[1], x[2], length.out = numk)
knots
knots        = seq(x[1], x[2], length.out = numk+1)
knots
for (i in 1:(length(knots)-1)){
array_lin [i,knots[i]:(knots[i+1]-1)] = S[knots[i]:(knots[i+1]-1)]-S[knots[i]]
}
array_lin
plot(X,basis_lin[,1],"l")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,6])
lines(X,basis_lin[,7])
basis_lin = t(as.matrix(array_lin))
plot(X,basis_lin[,1],"l")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,6])
lines(X,basis_lin[,7])
x          = range(order(X))#boundary knots
numk       = 5 #number of inner knots
lin_fun = function(numk){
x            = range(order(X))
knots        = seq(x[1], x[2], length.out = numk+1)
array_lin = array(0, dim = c((length(knots)-1), length(X)))
S = sort(X)
for (i in 1:(length(knots)-1)){
array_lin [i,knots[i]:(knots[i+1]-1)] = S[knots[i]:(knots[i+1]-1)]-S[knots[i]]
}
basis_lin = t(as.matrix(array_lin))
return(basis_lin)
}
plot(X,basis_lin[,1],"l")
lines(X,basis_lin[,7])
lines(X,basis_lin[,6])
lines(X,basis_lin[,5])
lines(X,basis_lin[,4])
lines(X,basis_lin[,3])
length(knots)
k          = 5 #number of inner knots
length(knots)
knots
x            = range(order(X))
knots        = seq(x[1], x[2], length.out = numk+2)
knots
lin_fun = function(numk){
x            = range(order(X))
knots        = seq(x[1], x[2], length.out = numk+2)
array_lin = array(0, dim = c((length(knots)-2), length(X)))
S = sort(X)
for (i in 1:(length(knots)-1)){
array_lin [i,knots[i]:(knots[i+1]-1)] = S[knots[i]:(knots[i+1]-1)]-S[knots[i]]
}
basis_lin = t(as.matrix(array_lin))
return(basis_lin)
}
lines(X,basis_lin[,6])
basis_lin
lin_fun(k)
k          = 5#number of inner knots
lin_fun(k)
k          = 5#number of inner knots
numk         = 5#number of inner knots
x            = range(order(X))
x
knots        = seq(x[1], x[2], length.out = numk+2)
knots
lin_fun = function(numk){
x            = range(order(X))
knots        = seq(x[1], x[2], length.out = numk+2)
array_lin = array(0, dim = c((length(knots)-1), length(X)))
S = sort(X)
for (i in 1:(length(knots)-1)){
array_lin [i,knots[i]:(knots[i+1]-1)] = S[knots[i]:(knots[i+1]-1)]-S[knots[i]]
}
basis_lin = t(as.matrix(array_lin))
return(basis_lin)
}
lin_fun(k)
plot(X,basis_lin[,1],"l")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,6])
lin_fun = function(numk){
x            = range(order(X))
knots        = seq(x[1], x[2], length.out = numk+2)
array_lin = array(0, dim = c((length(knots)-1), length(X)))
S = sort(X)
for (i in 1:(length(knots)-1)){
array_lin [i,knots[i]:(knots[i+1]-1)] = (S[knots[i]:(knots[i+1]-1)]-S[knots[i]])/((knots[i+1])-knots[i])
}
basis_lin = t(as.matrix(array_lin))
return(basis_lin)
}
plot(X,basis_lin[,1],"l")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,6])
knots[3+1]-knots[3]
k         = 5#number of inner knots
lin_fun = function(numk){
x            = range(order(X))
knots        = seq(x[1], x[2], length.out = numk+2)
array_lin = array(0, dim = c((length(knots)-1), length(X)))
S = sort(X)
for (i in 1:(length(knots)-1)){
array_lin [i,knots[i]:(knots[i+1]-1)] = (S[knots[i]:(knots[i+1]-1)]-S[knots[i]])/(knots[i+1]-knots[i])
}
basis_lin = t(as.matrix(array_lin))
return(basis_lin)
}
lin_fun(k)
lin_fun = function(numk){
x            = range(order(X))
knots        = seq(x[1], x[2], length.out = numk+2)
array_lin = array(0, dim = c((length(knots)-1), length(X)))
S = sort(X)
for (i in 1:(length(knots)-1)){
array_lin [i,knots[i]:(knots[i+1]-1)] = (S[knots[i]:(knots[i+1]-1)]-S[knots[i]])/(knots[i+1]-knots[i])
}
basis = t(as.matrix(array_lin))
return(basis)
}
basis_lin = lin_fun(k)
plot(X,basis_lin[,1],"l")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,6])
plot(X,basis_lin[,1],"l")
plot(X,basis_lin[,6],"l")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,1])
model.linsp = lm ( logwage ~ basis_lin, data = cps71)
model.linsp = lm ( logwage ~ basis_lin, data = cps71)
plot(cps71$age, cps71$logwage, xlab = "age", ylab = "log(wage)", cex=.9)
lines(cps71$age, fitted(model.linsp),  col = "blue", lwd = 2, main = "linear Spline")
lin_fun = function(numk){
x            = range(order(X))
knots        = seq(x[1], x[2], length.out = numk+2)
array_lin = array(0, dim = c((length(knots)-1), length(X)))
S = sort(X)
for (i in 1:(length(knots)-1)){
array_lin [i,knots[i]:(knots[i+1]-1)] = (S[knots[i]:(knots[i+1]-1)]-S[knots[i]])
+ (S[knots[i]:(knots[i+1]-1)]-S[knots[i]])^2
}
basis = t(as.matrix(array_lin))
return(basis)
}
#
basis_lin = lin_fun(k)
plot(X,basis_lin[,6],"l")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,1])
x          = range(order(X))#boundary knots
k         = 5#number of inner knots
lin_fun = function(numk){
x            = range(order(X))
knots        = seq(x[1], x[2], length.out = numk+2)
array_lin = array(0, dim = c((length(knots)-1), length(X)))
S = sort(X)
for (i in 1:(length(knots)-1)){
array_lin [i,knots[i]:(knots[i+1]-1)] = (S[knots[i]:(knots[i+1]-1)]-S[knots[i]])
+ (S[knots[i]:(knots[i+1]-1)]-S[knots[i]])^2
}
basis = t(as.matrix(array_lin))
return(basis)
}
#
basis_lin = lin_fun(k)
plot(X,basis_lin[,6],"l")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,1])
model.linsp = lm ( logwage ~ basis_lin, data = cps71)
plot(cps71$age, cps71$logwage, xlab = "age", ylab = "log(wage)", cex=.9)
lines(cps71$age, fitted(model.linsp),  col = "blue", lwd = 2, main = "linear Spline")
plot(cps71$age, cps71$logwage, xlab = "age", ylab = "log(wage)", cex=.9)
lines(cps71$age, fitted(model.linsp),  col = "blue", lwd = 2, main = "linear Spline")
plot(X,basis_lin[,6],"l")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,1])
x          = range(order(X))#boundary knots
k         = 5#number of inner knots
lin_fun = function(numk){
x            = range(order(X))
knots        = seq(x[1], x[2], length.out = numk+2)
array_lin = array(0, dim = c((length(knots)-1), length(X)))
S = sort(X)
for (i in 1:(length(knots)-1)){
array_lin [i,knots[i]:(knots[i+1]-1)] = (S[knots[i]:(knots[i+1]-1)]-S[knots[i]])^2
}
basis = t(as.matrix(array_lin))
return(basis)
}
basis_lin = lin_fun(k)
plot(X,basis_lin[,6],"l")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,1])
plot(X,basis1[,1],"l")
lines(X,basis1[,2])
lines(X,basis1[,3])
lines(X,basis1[,4])
lines(X,basis1[,5])
lines(X,basis1[,6])
lines(X,basis1[,7])
model.linsp = lm ( logwage ~ basis_lin, data = cps71)
plot(cps71$age, cps71$logwage, xlab = "age", ylab = "log(wage)", cex=.9)
lines(cps71$age, fitted(model.linsp),  col = "blue", lwd = 2, main = "linear Spline")
lin_fun = function(numk){
x            = range(order(X))
knots        = seq(x[1], x[2], length.out = numk+2)
array_lin = array(0, dim = c((length(knots)-1), length(X)))
S = sort(X)
for (i in 1:(length(knots)-1)){
array_lin [i,knots[i]:(knots[i+1]-1)] = (S[knots[i]:(knots[i+1]-1)]-S[knots[i]])
}
basis = t(as.matrix(array_lin))
return(basis)
}
basis_lin = lin_fun(k)
plot(X,basis_lin[,6],"l")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,1])
basis_lin = lin_fun(k)
plot(X,basis_lin[,6],"l", x="",y="",main = "basis functions of linear spline")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,1])
plot(X,basis_lin[,6],"l", x="",y="",main = "basis functions of linear spline")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,1])
plot(X,basis_lin[,6],"l", xlab="",ylab="",main = "basis functions of linear spline")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,1])
par(mfrow = c(1,3))
plot(cps71$age, cps71$logwage, xlab = "age", ylab = "log(wage)", cex=.9)
lines(cps71$age, fitted(model.lr),  col = "blue", lwd = 2, main = "linear regression")
lines(cps71$age, fitted(model.np),  col = "red", lwd = 2, main = "Kernel smoother" )
lines(model.lp, col = " green", lwd = 2, main = "local polynomial fitting")
#plot the results
par(mfrow = c(1,3))
plot(cps71$age, cps71$logwage, xlab = "age", ylab = "log(wage)", cex=.9)
lines(cps71$age, fitted(model.lr),  col = "blue", lwd = 2, main = "linear regression")
plot(cps71$age, cps71$logwage, xlab = "age", ylab = "log(wage)", cex=.9)
lines(cps71$age, fitted(model.np),  col = "red", lwd = 2, main = "Kernel smoother" )
plot(cps71$age, cps71$logwage, xlab = "age", ylab = "log(wage)", cex=.9)
lines(model.lp, col = " green", lwd = 2, main = "local polynomial fitting")
plot(cps71$age, cps71$logwage,  cex=.9)
plot(cps71$age, cps71$logwage,  cex=.9, main = "linear regression" , xlab = "", ylab="")
plot(cps71$age, cps71$logwage,  cex=.9, main = "linear regression" , xlab = "", ylab="")
lines(cps71$age, fitted(model.lr),  col = "blue", lwd = 2)
plot(cps71$age, cps71$logwage,  cex=.9, main = "Kernel smoother" , xlab = "", ylab="")
lines(cps71$age, fitted(model.np),  col = "red", lwd = 2)
plot(cps71$age, cps71$logwage,  cex=.9, main = "local polynomial fitting" , xlab = "", ylab="")
lines(model.lp, col = " green", lwd = 2)
plot(cps71$age, cps71$logwage, xlab = "age", ylab = "log(wage)", cex=.9)
lines(cps71$age, fitted(model.Bspline3), lty = 1, col = "green", lwd = 2)
lines(cps71$age, fitted(model.Bspline2), lty = 1, col = "blue", lwd = 2)
lines(cps71$age, fitted(model.Bspline1), lty = 1, col = "red", lwd = 2)
legend(22,15, c("D=3","D=10","D=25"),lty = 1 ,fill=c("red","blue","green"),cex=0.8)
#plot the results
par(mfrow = c(1,1))
plot(cps71$age, cps71$logwage, xlab = "age", ylab = "log(wage)", cex=.9)
lines(cps71$age, fitted(model.Bspline3), lty = 1, col = "green", lwd = 2)
lines(cps71$age, fitted(model.Bspline2), lty = 1, col = "blue", lwd = 2)
lines(cps71$age, fitted(model.Bspline1), lty = 1, col = "red", lwd = 2)
legend(22,15, c("D=3","D=10","D=25"),lty = 1 ,fill=c("red","blue","green"),cex=0.8)
plot(cps71$age, cps71$logwage, xlab = "age", ylab = "log(wage)", cex=.9)
lines(cps71$age, fitted(model.Bspline3), lty = 1, col = "green", lwd = 2)
lines(cps71$age, fitted(model.Bspline2), lty = 1, col = "blue", lwd = 2)
lines(cps71$age, fitted(model.Bspline1), lty = 1, col = "red", lwd = 2)
plot(cps71$age, cps71$logwage, xlab = "age", ylab = "log(wage)", cex=.9)
lines(cps71$age, fitted(model.pol1), lty = 1, col = "red", lwd = 2)
lines(cps71$age, fitted(model.pol2), lty = 1, col = "blue", lwd = 2)
lines(cps71$age, fitted(model.pol3), lty = 1, col = "green", lwd = 2)
plot(cps71$age, cps71$logwage, xlab = "", ylab = "", cex=.9)
lines(cps71$age, fitted(model.pol1), lty = 1, col = "red", lwd = 2)
lines(cps71$age, fitted(model.pol2), lty = 1, col = "blue", lwd = 2)
lines(cps71$age, fitted(model.pol3), lty = 1, col = "green", lwd = 2)
plot(cps71$age, cps71$logwage, xlab = "", ylab = "", cex=.9)
lines(cps71$age, fitted(model.Bspline3), lty = 1, col = "green", lwd = 2)
lines(cps71$age, fitted(model.Bspline2), lty = 1, col = "blue", lwd = 2)
lines(cps71$age, fitted(model.Bspline1), lty = 1, col = "red", lwd = 2)
plot(X,basis_lin[,6],"l", xlab="",ylab="",main = "")
lines(X,basis_lin[,2])
lines(X,basis_lin[,3])
lines(X,basis_lin[,4])
lines(X,basis_lin[,5])
lines(X,basis_lin[,1])
